#!/usr/bin/env node
const commander = require("commander");
const path = require("path");
const pkg = require("../package.json");

let startServer;

if (process.env.NODE_ENV === "development") {
  require("babel-register");
  startServer = require("../src/server/index").default;
} else {
  startServer = require("../lib/server/index");
}

commander.version(pkg.version);

commander.usage("[options] <projectDir>");

commander.parse(process.argv);

const projectPath = commander.args.length > 0 ? commander.args[0] : process.cwd();

console.log(`Starting ${pkg.name} server...`);
console.log(`Serving project directory: ${projectPath}`);

startServer({
  projectPath
})
  .then(() => {
    console.log(`Server listening on port ${commander.port || 8080}`);
  })
  .catch(e => {
    throw e;
  });
